Z Touch Plate & Reference Tool Setup
Use when you must set X/Y manually before probing Z. Captures the reference tool height at the fixed sensor.

; Tune these coordinates/feeds to match your sensor location and safe travel before using.
%macro.state.SAFE_HEIGHT = -5
%macro.state.PROBE_X_LOCATION = -1.5
%macro.state.PROBE_Y_LOCATION = -1224
%macro.state.PROBE_Z_LOCATION = -5
%macro.state.PROBE_DISTANCE = 150
%macro.state.PROBE_RAPID_FEEDRATE = 200
%macro.state.PLATE_THICKNESS = 11.95
%macro.state.Z_FAST_PROBE_DISTANCE = 50

%wait
M0 (Set X0/Y0 manually at your job origin, then move to a flat spot for Z probing and install the touch plate + clip.)
G90
G21
%macro.state.START_X = wx if wx is not None else 0.0
%macro.state.START_Y = wy if wy is not None else 0.0

G91
G38.2 Z-[macro.state.Z_FAST_PROBE_DISTANCE] F150
G90
G92 Z[macro.state.PLATE_THICKNESS]
G1 Z14
G91
G38.2 Z-15 F40
G0 Z2
G4 P0.25
G38.2 Z-3 F20
G90
G92 Z[macro.state.PLATE_THICKNESS]
G0 Z16

G0 Z20
M0 (Stow the touch plate and clip before measuring the tool height.)
%wait

G21
M5
G90
G53 G0 Z[macro.state.SAFE_HEIGHT]
G53 G0 X[macro.state.PROBE_X_LOCATION] Y[macro.state.PROBE_Y_LOCATION]
%wait
G53 Z[macro.state.PROBE_Z_LOCATION]

G91
G38.2 Z-[macro.state.PROBE_DISTANCE] F[macro.state.PROBE_RAPID_FEEDRATE]
G0 Z2
G4 P0.25
G38.2 Z-5 F40
G4 P0.25
G38.4 Z10 F20
G4 P0.25
G38.2 Z-2 F5
G4 P0.25
G38.4 Z10 F5
G90
%wait
%macro.state.TOOL_REFERENCE = mz
%msg (Reference tool height stored: [macro.state.TOOL_REFERENCE])
G91
G0 Z5
G90
G53 Z[macro.state.SAFE_HEIGHT]
%wait
G0 X[macro.state.START_X] Y[macro.state.START_Y]
